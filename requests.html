<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>طلبات التسجيل</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #fafafa;
      padding: 30px;
    }
    h1 {
      text-align: center;
      color: #333;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      max-width: 800px;
      margin: 20px auto;
      background: white;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 12px 15px;
      border: 1px solid #ddd;
      text-align: center;
    }
    th {
      background-color: #4a90e2;
      color: white;
    }
    tr:nth-child(even) {
      background-color: #f7f9fc;
    }
    .status-pending {
      color: #e67e22;
      font-weight: bold;
    }
    .status-approved {
      color: #27ae60;
      font-weight: bold;
    }
    .status-rejected {
      color: #c0392b;
      font-weight: bold;
    }
  </style>
</head>
<body>

<h1>طلبات التسجيل</h1>

<table>
  <thead>
    <tr>
      <th>اسم المستخدم</th>
      <th>البريد الإلكتروني</th>
      <th>تاريخ الطلب</th>
      <th>الحالة</th>
    </tr>
  </thead>
  <tbody id="requestsBody">
    <tr><td colspan="4">جارٍ التحميل...</td></tr>
  </tbody>
</table>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDjbYxe_Qzn2A_ZfiUT8N8HXWb3H4IE1JI",
    authDomain: "login-eb6c5.firebaseapp.com",
    projectId: "login-eb6c5",
    storageBucket: "login-eb6c5.appspot.com",
    messagingSenderId: "250914385010",
    appId: "1:250914385010:web:8210b211e198340f7ee6eb",
    measurementId: "G-X9VL9K7BVX"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const requestsBody = document.getElementById('requestsBody');

  function loadRequests(){
    requestsBody.innerHTML = '<tr><td colspan="4">جارٍ التحميل...</td></tr>';

    db.collection('registrationRequests').orderBy('requestedAt', 'desc').get()
      .then(snapshot => {
        if(snapshot.empty){
          requestsBody.innerHTML = '<tr><td colspan="4">لا توجد طلبات حالياً.</td></tr>';
          return;
        }

        let html = '';
        snapshot.forEach(doc => {
          const data = doc.data();
          const username = data.username || '-';
          const email = data.email || '-';
          const timestamp = data.requestedAt ? data.requestedAt.toDate().toLocaleString() : '-';
          const status = data.status || 'pending';

          let statusClass = '';
          if(status === 'pending') statusClass = 'status-pending';
          else if(status === 'approved') statusClass = 'status-approved';
          else if(status === 'rejected') statusClass = 'status-rejected';

          html += `
            <tr>
              <td>${username}</td>
              <td>${email}</td>
              <td>${timestamp}</td>
              <td class="${statusClass}">${status}</td>
            </tr>
          `;
        });

        requestsBody.innerHTML = html;
      })
      .catch(err => {
        requestsBody.innerHTML = `<tr><td colspan="4">حدث خطأ: ${err.message}</td></tr>`;
      });
  }

  loadRequests();
</script>

</body>
</html>
